{% extends "index.html" %}
{% load static %}
{% load widget_tweaks %}
{% block content %}

<div class="container-fluid py-4">
  <div class="card shadow border-0">
    <div class="card-header bg-gradient-info pb-3 border-radius-lg d-flex justify-content-between align-items-center">
      <div>
        <h4 class="text-white mb-0">Transactions</h4>
        <p class="text-white-50 mb-0">Your recent transactions</p>
      </div>
      <a href="{% url 'add_transaction' %}" class="btn btn-light text-info fw-bold">Add Transaction</a>
    </div>
    <div class="card-body">
      <!-- Django Filter Form -->
      <!-- Date Range Picker CSS (CDN) -->
      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
      <form method="get" class="row mb-3 align-items-end">
        {% for field in filter.form.visible_fields %}
          <div class="col-md-3 mb-2">
            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
            {% if field.name == 'date_range' %}
              {% render_field field class="form-control" autocomplete="off" %}
            {% elif field.field.widget.input_type == 'select' or field.field.widget.input_type == 'select-multiple' %}
              {% render_field field class="form-select" %}
            {% else %}
              {% render_field field class="form-control" %}
            {% endif %}
            {% if field.errors %}
              <div class="text-danger small">{{ field.errors|striptags }}</div>
            {% endif %}
          </div>
        {% endfor %}
        <div class="col-md-2 mb-2">
          <button type="submit" class="btn btn-info w-100">Filter</button>
        </div>
      </form>
      <!-- Transactions Table -->
      <div class="table-responsive">
        <table class="table align-middle mb-0" id="transactionsTable">
          <thead class="text-center">
            <tr>
              <th>
                <p class="text-center font-weight-bold mb-0">Date</p>
                <p class="text-center text-secondary mb-0">Type</p>
              </th>
              <th>
                <p class="text-center font-weight-bold mb-0">Transaction #</p>
                <p class="text-center text-secondary mb-0">Amount</p>
              </th>
              <th>
                <p class="text-center font-weight-bold mb-0">Property</p>
                <p class="text-center text-secondary mb-0">Tenant</p>
              </th>
              <th>Description</th>
              <th>View/Download</th>
            </tr>
          </thead>
          <tbody>
            {% for transaction in transactions %}
            <tr>
              <td>
                <div class="d-flex px-2 py-1">
                  <div>
                    <img src="/static/assets/img/team-2.jpg" class="avatar avatar-sm me-3" alt="user1">
                  </div>
                  <div class="d-flex flex-column justify-content-center">
                    <h6 class="mb-0 text-sm">{{ transaction.created_at|date:"d-M-Y" }}</h6>
                    <p class="text-xs text-secondary mb-0">{{ transaction.type }}</p>
                  </div>
                </div>
              </td>
              <td>
                <p class="text-xs text-center font-weight-bold mb-0">{{ transaction.transaction_number }}</p>
                <p class="text-xs text-center text-secondary mb-0">${{ transaction.amount }}</p>
              </td>
              <td>
                <p class="text-xs text-center font-weight-bold mb-0">{{ transaction.property }}</p>
                <p class="text-xs text-center text-secondary mb-0">{{ transaction.tenant }}</p>
              </td>
              <td class="text-sm text-center">{{ transaction.description }}</td>
              <td class="text-center">
                <a href="{% url 'transaction_pdf' transaction.id %}" title="Download PDF">
                  <i class="bi bi-filetype-pdf fs-3"></i>
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center">No transactions found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- jQuery and Date Range Picker JS (CDN) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script src="/static/assets/js/custom.js"></script>

<script>
  $(function() {
    var $dateRange = $("#id_date_range");
    if ($dateRange.length) {
      $dateRange.daterangepicker({
        autoUpdateInput: false,
        locale: {
          format: 'YYYY-MM-DD',
          cancelLabel: 'Clear'
        }
      });
      $dateRange.on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('YYYY-MM-DD') + ' - ' + picker.endDate.format('YYYY-MM-DD'));
      });
      $dateRange.on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
      });
    }
  });
</script>
{% endblock %}